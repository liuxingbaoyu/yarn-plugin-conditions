/* eslint-disable */
module.exports = {
name: "@yarnpkg/plugin-conditions",
factory: function (require) {
var plugin;plugin=(()=>{"use strict";var e={216:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionFetcher=void 0;var n=r(966),o=u(r(572)),i=r(837),a=r(822),s=u(r(104));function c(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return c=function(){return e},e}function u(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=c();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}t.ConditionFetcher=class{supports(e){return o.hasConditionProtocol(e.reference)}getLocalPath(){return null}async fetch(e,t){const r=t.checksums.get(e.locatorHash)||null,[o,i,a]=await t.cache.fetchPackageFromCache(e,r,{onHit:()=>t.report.reportCacheHit(e),onMiss:()=>t.report.reportCacheMiss(e,n.structUtils.prettyLocator(t.project.configuration,e)+" can't be found in the cache and will be fetched from the disk"),loader:()=>this.generateConditionPackage(e,t),skipIntegrityCheck:t.skipIntegrityCheck});return{packageFs:o,releaseFs:i,prefixPath:n.structUtils.getIdentVendorPath(e),localPath:this.getLocalPath(),checksum:a}}async generateConditionPackage(e,t){const{test:r,consequent:n,alternate:c}=o.parseLocator(e),u=(0,i.getDefaultTestValue)(t.project,r),l=s.name(e),p=o.makeHash(r,n,c,u);return(0,a.createSimplePackage)(e,t.project,{version:"0.0.0-condition-"+p,dependencies:{[`${l}-${r}-true`]:n,[`${l}-${r}-false`]:c}},`// env vars from the cli are always strings, so !!ENV_VAR returns true for "false"\nfunction bool(value) {\n  if (value == null) return ${u};\n  return value && value !== "false" && value !== "0";\n}\n\nmodule.exports = bool(process.env[${JSON.stringify(r)}])\n  ? require(${JSON.stringify(`${l}-${r}-true`)})\n  : require(${JSON.stringify(`${l}-${r}-false`)});\n`)}}},231:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionResolver=void 0;var n=r(966),o=c(r(572)),i=c(r(201)),a=r(837);function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}t.ConditionResolver=class{supportsDescriptor(e){return o.hasConditionProtocol(e.range)}supportsLocator(e){return o.hasConditionProtocol(e.reference)}shouldPersistResolution(){return!1}bindDescriptor(e){return e}getResolutionDependencies(e){const{test:t,consequent:r,alternate:n}=o.parseDescriptor(e);return[i.makeVirtualDescriptor(t,!0,e.scope,e.name,r),i.makeVirtualDescriptor(t,!1,e.scope,e.name,n)].filter(Boolean)}async getCandidates(e,t,r){if(i.isConditionProxy(e.range))return[i.makeLocator(e,i.parseDescriptor(e))];const{test:n,consequent:s,alternate:c}=o.parseDescriptor(e),u=o.makeHash(n,s,c,(0,a.getDefaultTestValue)(r.project,n));return[o.makeLocator(e,{test:n,consequent:s,alternate:c,hash:u})]}async getSatisfying(){return null}async resolve(e,t){const{test:r,consequent:s,alternate:c}=o.parseLocator(e),u=o.makeHash(r,s,c,(0,a.getDefaultTestValue)(t.project,r)),l=i.makeVirtualDescriptor(r,!0,e.scope,e.name,s),p=i.makeVirtualDescriptor(r,!1,e.scope,e.name,c);return{...e,version:"0.0.0-condition-"+u,languageName:t.project.configuration.get("defaultLanguageName"),linkType:n.LinkType.HARD,dependencies:new Map([l&&[l.identHash,l],p&&[p.identHash,p]].filter(Boolean)),peerDependencies:new Map,dependenciesMeta:new Map,peerDependenciesMeta:new Map,bin:null}}}},406:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.parse=function(e){if(!e.startsWith("condition:",0))throw new Error(`Expected 'condition:' at index 0 (${e})`);let t="condition:".length;s();const r=c(/[\w-]+/y);if(!r)throw new Error(`Expected an identifier at index ${t} (${e})`);s(),a("?"),s();let n=null;"("===e[t]?(n=l().trim(),s()):":"!==e[t]&&(n=u(":").trimRight());a(":"),s();let o=null;t<e.length&&("("===e[t]?(o=l().trim(),s()):":"!==e[t]&&(o=u("#").trimRight()));let i=null;t<e.length&&"#"===e[t]&&(t++,i=c(/\w+/y),s());if(t!==e.length)throw new Error(`Unexpected '${e[t]}' at index ${t} (${e})`);return{test:r,consequent:n,alternate:o,hash:i};function a(r){if(e[t]!==r)throw new Error(`Expected '${r}' at index ${t} (${e})`);t++}function s(){c(/\s*/y)}function c(r){r.lastIndex=t;const n=r.exec(e);return n?(t+=n[0].length,n[0]):null}function u(r){const n=t;return t=e.indexOf(r,n),-1===t&&(t=e.length),e.slice(n,t)}function l(){a("(");let r=1,n="";for(;r;){if(t===e.length)throw new Error(`Expected ')' at index ${t} (${e})`);const o=e[t];"("===o&&r++,")"===o&&r--,(")"!==o||r>0)&&(n+=o),t++}return n}}},572:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.hasConditionProtocol=function(e){return e.startsWith("condition:")},t.parseDescriptor=function(e){return(0,o.parse)(e.range)},t.parseLocator=function(e){return(0,o.parse)(e.reference)},t.makeDescriptor=function(e,{test:t,consequent:r,alternate:o}){return n.structUtils.makeDescriptor(e,a({test:t,consequent:r,alternate:o,hash:null}))},t.makeLocator=function(e,{test:t,consequent:r,alternate:o,hash:i}){return n.structUtils.makeLocator(e,a({test:t,consequent:r,alternate:o,hash:i}))},t.makeHash=function(e,t,r,o){return n.hashUtils.makeHash(String(i.CACHE_VERSION),e,t||"-",r||"-",o?"1":"0").slice(0,6)};var n=r(966),o=r(406),i=r(638);function a({test:e,consequent:t,alternate:r,hash:n}){let o=t||"",i=r||"";return o&&/[:\?#]/.test(o)&&(o=`(${o})`),i&&/[:\?#]/.test(i)&&(i=`(${i})`),`condition:${e}?${o}:${i}#${n||""}`}},821:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionProxyFetcher=void 0;var n=r(966),o=r(822),i=c(r(201)),a=c(r(104));function s(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return s=function(){return e},e}function c(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=s();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}return r.default=e,t&&t.set(e,r),r}t.ConditionProxyFetcher=class{supports(e){return i.isConditionProxy(e.reference)}getLocalPath(){return null}async fetch(e,t){const r=t.checksums.get(e.locatorHash)||null,[o,i,a]=await t.cache.fetchPackageFromCache(e,r,{onHit:()=>t.report.reportCacheHit(e),onMiss:()=>t.report.reportCacheMiss(e,n.structUtils.prettyLocator(t.project.configuration,e)+" can't be found in the cache and will be fetched from the disk"),loader:()=>this.generateConditionProxyPackage(e,t),skipIntegrityCheck:t.skipIntegrityCheck});return{packageFs:o,releaseFs:i,prefixPath:n.structUtils.getIdentVendorPath(e),localPath:this.getLocalPath(),checksum:a}}async generateConditionProxyPackage(e,t){const{scope:r,name:s,range:c}=i.parseLocator(e),u=i.makeHash(r,s,c),l=a.name(n.structUtils.makeIdent(r,s));return(0,o.createSimplePackage)(e,t.project,{version:"0.0.0-condition-proxy-"+u,dependencies:{[l]:c}},`module.exports = require(${JSON.stringify(l)})`)}}},742:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ConditionProxyResolver=void 0;var n=r(966),o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var a=n?Object.getOwnPropertyDescriptor(e,o):null;a&&(a.get||a.set)?Object.defineProperty(r,o,a):r[o]=e[o]}r.default=e,t&&t.set(e,r);return r}(r(201));function i(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}t.ConditionProxyResolver=class{supportsDescriptor(e){return o.isConditionProxy(e.range)}supportsLocator(e){return o.isConditionProxy(e.reference)}shouldPersistResolution(){return!1}bindDescriptor(e){return e}getResolutionDependencies(e){const{scope:t,name:r,range:i}=o.parseDescriptor(e);return[n.structUtils.makeDescriptor(n.structUtils.makeIdent(t,r),i)]}async getCandidates(e,t,r){return[o.makeLocator(e,o.parseDescriptor(e))]}async getSatisfying(){return null}async resolve(e,t){const{scope:r,name:i,range:a}=o.parseLocator(e),s=o.makeHash(r,i,a),c=n.structUtils.makeDescriptor(n.structUtils.makeIdent(r,i),a);return console.log("PROXY DEP",c),{...e,version:"0.0.0-condition-proxy-"+s,languageName:t.project.configuration.get("defaultLanguageName"),linkType:n.LinkType.HARD,dependencies:new Map([[c.identHash,c]]),peerDependencies:new Map,dependenciesMeta:new Map,peerDependenciesMeta:new Map,bin:null}}}},201:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isConditionProxy=function(e){return e.startsWith(s)},t.parseDescriptor=function(e){return c(e.range)},t.parseLocator=function(e){return c(e.reference)},t.makeVirtualDescriptor=function(e,t,r,o,i){return i?n.structUtils.makeDescriptor(n.structUtils.makeIdent(r,`${o}-${e}-${t}`),u({scope:r,name:o,range:i})):null},t.makeLocator=function(e,{scope:t,name:r,range:o}){return n.structUtils.makeLocator(e,u({scope:t,name:r,range:o}))},t.makeHash=function(e,t,r){return n.hashUtils.makeHash(String(o.CACHE_VERSION),e,t,r).slice(0,6)};var n=r(966),o=r(638),i=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}r.default=e,t&&t.set(e,r);return r}(r(104));function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}const s="condition_proxy_internal:";function c(e){const t=e.indexOf(":",s.length);let r="",n=e.slice(s.length,t);return n.startsWith("@")&&([r,n]=n.slice(1).split("/")),{name:n,scope:r,range:e.slice(t+1)}}function u({scope:e,name:t,range:r}){return`${s}${i.name({name:t,scope:e})}:${r}`}},837:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDefaultTestValue=function(e,t){return i(e,t),e.configuration.get("conditions").get(t).get("default")},t.evaluateTest=function(e,t){var r;i(e,t);const n=e.configuration.get("conditions").get(t),o=n.get("source"),a=n.get("default");if("env"!==o)throw new Error("The only supported configuration source is 'env'");return null!==(s=process.env[t],r=s&&"false"!==s&&"0"!==s)&&void 0!==r?r:a;var s},t.configuration=void 0;var n=r(966);const o={conditions:{description:"",type:n.SettingsType.MAP,valueDefinition:{description:"",type:n.SettingsType.SHAPE,properties:{source:{description:"",type:n.SettingsType.STRING,default:"env"},default:{description:"",type:n.SettingsType.BOOLEAN,default:!1}}}}};function i(e,t){if(!e.configuration.get("conditions").has(t))throw new Error(`Unknown condition: ${t}. You must add it to your .yarnrc.yml file.`)}t.configuration=o},638:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.mtime=t.CACHE_VERSION=void 0;t.CACHE_VERSION=1.8;t.mtime=15805116e5},878:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.beforeWorkspacePacking=function(e,t){const{project:r}=e;console.log("PACK",t);for(const a of s){const s=e.manifest.getForScope(a);for(const[e,c]of s){if(!o.hasConditionProtocol(c.range))continue;const{test:u,consequent:l,alternate:p}=o.parseDescriptor(c),f=(0,i.evaluateTest)(r,u)?l:p,d=n.structUtils.stringifyIdent(c);f?(t[a][d]=f,c.range=f):(delete t[a][d],s.delete(e))}}};var n=r(966),o=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var i=n?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(r,o,i):r[o]=e[o]}r.default=e,t&&t.set(e,r);return r}(r(572)),i=r(837);function a(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return a=function(){return e},e}const s=["dependencies","devDependencies","peerDependencies"]},104:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.name=function(e){return e.scope?`@${e.scope}/${e.name}`:e.name}},496:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=r(231),o=r(216),i=r(742),a=r(821),s=r(878);const c={configuration:r(837).configuration,fetchers:[o.ConditionFetcher,a.ConditionProxyFetcher],resolvers:[n.ConditionResolver,i.ConditionProxyResolver],hooks:{beforeWorkspacePacking:s.beforeWorkspacePacking}};t.default=c},822:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSimplePackage=async function(e,t,r,s){const[c,u]=await Promise.all([o.xfs.mktempPromise(),(0,i.getLibzipPromise)()]),l=o.ppath.join(c,"condition.zip"),p=n.structUtils.getIdentVendorPath(e),f=new o.ZipFS(l,{libzip:u,create:!0,level:t.configuration.get("compressionLevel")});return await f.mkdirpPromise(p),await Promise.all([f.writeJsonPromise(o.ppath.join(p,"package.json"),r),f.writeFilePromise(o.ppath.join(p,"index.js"),s)]),await Promise.all(f.getAllFiles().map(e=>f.utimesPromise(e,a.mtime,a.mtime))),f};var n=r(966),o=r(688),i=r(76),a=r(638)},966:e=>{e.exports=require("@yarnpkg/core")},688:e=>{e.exports=require("@yarnpkg/fslib")},76:e=>{e.exports=require("@yarnpkg/libzip")}},t={};return function r(n){if(t[n])return t[n].exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}(496)})();
return plugin;
}
};